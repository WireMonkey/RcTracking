@using RcTracking.Shared.Model
@using RcTracking.UI.Interface
@using RcTracking.UI.Services
@using System.Threading.Tasks

<MudDialog>
	<TitleContent>
		New Plane
	</TitleContent>
	<DialogContent>
		<MudGrid Spacing="3">
			<MudItem xs="12">
				<MudTextField @bind-Value="name" Label="Name" Variant="Variant.Filled" FullWidth="true" />
			</MudItem>
			<MudItem xs="4">
				<MudTextField @bind-Value="prop" Label="Prop" Variant="Variant.Filled" FullWidth="true" />
			</MudItem>
			<MudItem xs="4">
				<MudTextField @bind-Value="battery" Label="Battery" Variant="Variant.Filled" FullWidth="true" />
			</MudItem>
			<MudItem xs="4" justify-center>
				<MudSwitch @bind-Value="flying" Label="Flying" Color="Color.Primary" LabelPlacement="Placement.Start" />
			</MudItem>
			<MudItem xs="12">
				<MudTextField T="string" Label="Notes" Variant="Variant.Text" Text="@notes" Lines="5" />
			</MudItem>
		</MudGrid>
		<MudOverlay @bind-Visible="_visible" DarkBackground AutoClose="true" />
	</DialogContent>
	<DialogActions>
		<MudButton OnClick="Cancel">Cancel</MudButton>
		<MudButton Color="Color.Primary" OnClick="Submit">OK</MudButton>
	</DialogActions>
</MudDialog>

@code {
	[CascadingParameter]
	private IMudDialogInstance MudDialog { get; set; }

	[Inject]
	private IPlaneService PlaneService { get; set; }

	private bool _visible = false;

	private string name { get; set; } = string.Empty;
	private string prop { get; set; } = string.Empty;
	private string battery { get; set; } = string.Empty;
	private string notes { get; set; } = string.Empty;
	private bool flying { get; set; } = false;

	private async Task Submit()
	{
		_visible = true;
		var nPlane = new PlaneModel(Guid.Empty, name, prop, battery, notes, flying);
		await PlaneService.AddPlaneAsync(nPlane);
		MudDialog.Close(DialogResult.Ok(true));
		_visible = false;
	}

	private void Cancel() => MudDialog.Cancel();
}
